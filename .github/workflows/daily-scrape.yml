name: Daily Scrape (Manual Only)

on:
  workflow_dispatch:   # Only runs when manually triggered

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: npm

      - name: Install dependencies
        run: npm ci

      # ATS discovery (optional)
      - name: Discover ATS URLs from seed companies
        run: |
          npx tsx scripts/discoverATSBulk.ts || true
          npx tsx scripts/discoverATS.ts || true

      # Generic career page scraper (optional)
      - name: Scrape careers for companies without ATS
        env:
          CAREER_BATCH: 20
          CAREER_MAX_BATCHES: 1
        run: npx tsx scripts/scrapeCareerPages.ts || true

      # ⚠️ IMPORTANT:
      # This version does NOT include DATABASE_URL because
      # GitHub should NOT run production scrapers anymore.
      - name: MANUAL Run daily scraper (local DB ONLY if configured)
        run: npx tsx scripts/dailyScrapeV2.ts --mode=all --concurrency=6 || true
